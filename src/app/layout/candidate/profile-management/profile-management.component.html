<span class="title">Update Profile</span>

<form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
  <mat-accordion multi>

    <!-- Personal Information -->
    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header class="header">
        <mat-panel-title> Personal Information </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="group-form-field">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Full Name</mat-label>
          <input matInput formControlName="fullName" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email"/>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Phone</mat-label>
          <input matInput formControlName="phone" />
        </mat-form-field>
      </div>

      <!-- Profile Photo Upload -->
    <div class="profile-photo-container">
      <div class="profile-photo-preview" *ngIf="profilePhoto">
        <img [src]="profilePhoto" alt="Profile Photo" />
      </div>
      
      <input type="file" id="profilePhotoInput" (change)="onProfilePhotoUpload($event)" accept="image/*" hidden/>
      <button mat-flat-button class="upload-btn" (click)="triggerProfilePhotoUpload()">
        {{ profilePhoto ? 'Change Profile Photo' : 'Upload Profile Photo'}}
      </button>
    </div>
    </mat-expansion-panel>

    <!-- Dynamic Education Section -->
    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header class="header">
        <mat-panel-title> Education Details </mat-panel-title>
      </mat-expansion-panel-header>
      <div formArrayName="education">
        <div *ngFor="let edu of educationControls.controls; let i = index" [formGroupName]="i" class="group-form-field">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Degree</mat-label>
            <input matInput formControlName="degree" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>University</mat-label>
            <input matInput formControlName="institute" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Year of Completion</mat-label>
            <input matInput type="number" formControlName="yearOfCompletion" />
          </mat-form-field>

          <!-- Upload Educational Documents -->
          <div class="upload-section">
            <input type="file" (change)="onFileUpload($event, 'education', i)" />
          </div>

          <button mat-icon-button color="warn" (click)="removeEducation(i)" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-flat-button class="btn" (click)="addEducation()">+ Add Education</button>
    </mat-expansion-panel>

    <!-- Dynamic Experience Section -->
    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header class="header">
        <mat-panel-title> Previous Employment </mat-panel-title>
      </mat-expansion-panel-header>
      <div formArrayName="experience">
        <div *ngFor="let exp of experienceControls.controls; let i = index" [formGroupName]="i" class="group-form-field">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Company Name</mat-label>
            <input matInput formControlName="company" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Designation</mat-label>
            <input matInput formControlName="designation" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Years of Experience</mat-label>
            <input matInput type="number" formControlName="years" />
          </mat-form-field>

          <!-- Upload Experience Documents -->
          <div class="upload-section">
            <input type="file" (change)="onFileUpload($event, 'experience', i)" />
          </div>

          <button mat-icon-button color="warn" (click)="removeExperience(i)" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-flat-button class="btn" (click)="addExperience()">+ Add Experience</button>
    </mat-expansion-panel>

    <!-- Skills Section -->
    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header class="header">
        <mat-panel-title> Skills </mat-panel-title>
      </mat-expansion-panel-header>
      <div formArrayName="skills">
        <div *ngFor="let skill of skillsControls.controls; let i = index" [formGroupName]="i" class="group-form-field">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Skill Name</mat-label>
            <input matInput formControlName="skillName" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Experience (Years)</mat-label>
            <input matInput type="number" formControlName="experienceYears" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Last Used Year</mat-label>
            <input matInput type="number" formControlName="lastUsedYear" />
          </mat-form-field>

          <!-- Upload Skill Certification -->
          <div class="upload-section">
            <input type="file" (change)="onFileUpload($event, 'skills', i)" />
          </div>

          <button mat-icon-button (click)="removeSkill(i)" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-flat-button class="btn" (click)="addSkill()">+ Add Skill</button>
    </mat-expansion-panel>

    <!-- Upload CV -->
    <mat-expansion-panel expanded="true">
      <mat-expansion-panel-header class="header">
        <mat-panel-title> Upload CV </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="upload-section">
        <input type="file" (change)="onFileUpload($event, 'cv')" />
      </div>

      <div class="form-actions">
        <button class="btn" type="submit">Update Profile</button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</form>
